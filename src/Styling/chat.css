/* ================================
   Modern Chat Support Widget (Slim)
   ================================ */

/* ---------- Tokens ---------- */
:root{
  --chat-primary:#2563eb;
  --chat-primary-hover:#1d4ed8;
  --chat-primary-light:#dbeafe;

  --chat-success:#059669;
  --chat-danger:#dc2626;
  --chat-warning:#d97706;

  --chat-bg:#fff;
  --chat-surface:#f8fafc;
  --chat-surface-hover:#f1f5f9;
  --chat-border:#e2e8f0;
  --chat-text:#1e293b;
  --chat-text-muted:#64748b;
  --chat-text-light:#94a3b8;

  --chat-radius:.75rem;
  --chat-radius-sm:.5rem;
  --chat-radius-lg:1rem;

  --chat-shadow-sm:0 1px 2px 0 rgb(0 0 0 / 0.05);
  --chat-shadow:0 4px 6px -1px rgb(0 0 0 / .1),0 2px 4px -2px rgb(0 0 0 / .1);
  --chat-shadow-xl:0 20px 25px -5px rgb(0 0 0 / .1),0 8px 10px -6px rgb(0 0 0 / .1);

  /* hamburger sizing */
  --hb-size:40px;
  --hb-gap:4px;
  --hb-bar-w:20px;
  --hb-bar-h:2px;
  --hb-x-shift:6px;
}

@media (prefers-color-scheme: dark){
  :root{
    --chat-primary:#3b82f6;
    --chat-primary-hover:#2563eb;
    --chat-primary-light:#1e3a8a;

    --chat-bg:#0f172a;
    --chat-surface:#1e293b;
    --chat-surface-hover:#334155;
    --chat-border:#334155;
    --chat-text:#f1f5f9;
    --chat-text-muted:#94a3b8;
    --chat-text-light:#64748b;

    --chat-shadow-sm:0 1px 2px 0 rgb(0 0 0 / .3);
    --chat-shadow:0 4px 6px -1px rgb(0 0 0 / .3),0 2px 4px -2px rgb(0 0 0 / .3);
    --chat-shadow-xl:0 20px 25px -5px rgb(0 0 0 / .3),0 8px 10px -6px rgb(0 0 0 / .3);
  }
  
}

/* ---------- Launcher ---------- */
.chat-launcher{
  position:fixed; right:1.5rem; bottom:1.5rem; z-index:1000;
  display:flex; align-items:center; justify-content:center; gap:.5rem;
  min-width:3.5rem; min-height:3.5rem; padding:1rem 1.5rem;
  background:var(--chat-primary); color:#fff; border:0; border-radius:var(--chat-radius-lg);
  font-weight:600; font-size:.875rem; cursor:pointer;
  box-shadow:var(--chat-shadow); transition:all .2s ease;
}
.chat-launcher:hover{ background:var(--chat-primary-hover); transform:translateY(-2px); box-shadow:var(--chat-shadow-xl); }
.chat-launcher:active{ transform:translateY(0); }

/* ---------- Container (desktop default) ---------- */
.chat-container{
  position:fixed; right:1.5rem; bottom:6rem; z-index:999;
  display:flex; flex-direction:row; overflow:hidden;
  width:100vw; max-width:800px; height:600px; max-height:80vh;
  background:var(--chat-bg); border:1px solid var(--chat-border);
  border-radius:var(--chat-radius-lg); box-shadow:var(--chat-shadow-xl);
}

/* ---------- Sidebar ---------- */
.chat-sidebar{
  width:320px; flex-shrink:0; background:var(--chat-surface);
  border-right:1px solid var(--chat-border); display:flex; flex-direction:column; min-height:0;
}
.chat-sidebar-header{
  padding:1rem; border-bottom:1px solid var(--chat-border);
  display:flex; align-items:center; justify-content:space-between; background:var(--chat-bg);
}
.chat-sidebar-header strong{ color:var(--chat-text); font-size:.875rem; font-weight:600; }
.chat-reload{
  background:none; border:0; color:var(--chat-text-muted);
  width:1.75rem; height:1.75rem; border-radius:var(--chat-radius-sm);
  display:grid; place-items:center; cursor:pointer; transition:all .2s ease;
}
.chat-reload:hover{ background:var(--chat-surface-hover); color:var(--chat-text); }

/* Close button (same vibe as reload) */
.chat-close{
  background:none; border:0; color:var(--chat-text-muted);
  width:2rem; height:2rem; border-radius:var(--chat-radius-sm);
  display:inline-flex; align-items:center; justify-content:center;
  transition:background .2s ease, color .2s ease, transform .06s ease;
  margin-left:.25rem;
}
.chat-close:hover{ background:var(--chat-surface-hover); color:var(--chat-text); }
.chat-close:active{ transform:translateY(1px); }

.chat-new-btn-support{
  margin:12px; position: relative; left: 80px; width:160px; padding:.75rem 1rem; border:0; border-radius:13px;
  background:#537df3; color:#fff; cursor:pointer; transition:background .2s ease;
  
}
.chat-new-btn-support:hover{ background:var(--chat-primary-hover); }

.chat-thread-list{ flex:1; overflow-y:auto; padding:0 .5rem .5rem; }
.chat-thread-item{
  padding:.75rem; margin:.25rem 0; border-radius:var(--chat-radius);
  cursor:pointer; transition:all .2s ease; border:1px solid transparent;
}
.chat-thread-item:hover{ background:var(--chat-surface-hover); }
.chat-thread-item.active{ background:var(--chat-primary-light); border-color:var(--chat-primary); }
.chat-thread-topic{ font-weight:500; font-size:.875rem; color:var(--chat-text); margin-bottom:.25rem; line-height:1.4; }
.chat-thread-meta{ display:flex; align-items:center; justify-content:space-between; gap:.5rem; font-size:.75rem; color:var(--chat-text-muted); }
.chat-thread-meta span[data-status]{ padding:.125rem .5rem; border-radius:9999px; font-weight:500; text-transform:capitalize; }
.chat-thread-meta span[data-status="open"]{ background:#dcfce7; color:#166534; }
.chat-thread-meta span[data-status="closed"]{ background:#fee2e2; color:#991b1b; }
.chat-thread-meta span[data-status="pending"]{ background:#fef3c7; color:#92400e; }

/* ---------- Window ---------- */
.chat-window{ flex:1; display:flex; flex-direction:column; min-height:0; position:relative; }
.chat-window-header{
  padding:1rem; border-bottom:1px solid var(--chat-border);
  background:var(--chat-bg); display:flex; align-items:center; justify-content:space-between;
}
.chat-window-title strong{ color:var(--chat-text); font-size:.875rem; font-weight:600; }
.chat-conn{ display:flex; align-items:center; gap:.5rem; font-size:.75rem; color:var(--chat-text-muted); }
.conn-dot{ width:.5rem; height:.5rem; border-radius:50%; transition:all .2s ease; }
.conn-dot.online{ background:var(--chat-success); box-shadow:0 0 0 2px rgba(16,185,129,.2); }
.conn-dot.offline{ background:var(--chat-danger); box-shadow:0 0 0 2px rgba(239,68,68,.2); }

/* Topic edit / delete buttons */
.topic-edit-btn,.chat-delete-btn{
  appearance:none; border:0; background:transparent;
  width:40px; height:32px; border-radius:6px; display:inline-flex; align-items:center; justify-content:center;
  color:inherit; cursor:pointer; transition:background .15s ease, transform .05s ease, opacity .15s ease;
  position: relative; left: 10px; top: 5px;
}
.topic-edit-btn:hover,.chat-delete-btn:hover{ background:rgba(0,0,0,.06); }
.topic-edit-btn:active,.chat-delete-btn:active{ transform:translateY(1px); }
.chat-delete-btn{ color:#ef4444; position: relative; right: 15px; }
.chat-delete-btn:hover{ background:rgba(239,68,68,.08); }
.topic-edit{ display:inline-flex; align-items:center; gap:8px; }
.topic-input{
  height:32px; padding:0 10px; border-radius:8px; border:1px solid var(--chat-border);
  background:var(--chat-bg); color:var(--chat-text); font-size:14px;
  transition:border-color .18s ease, box-shadow .18s ease;
}
.topic-input:focus{
  outline:none; border-color:color-mix(in srgb, var(--chat-primary) 60%, transparent);
  box-shadow:0 0 0 3px color-mix(in srgb, var(--chat-primary) 18%, transparent);
}

/* ---------- Messages ---------- */
.chat-messages{
  flex:1; overflow-y:auto; padding:1rem; display:flex; flex-direction:column; gap:1rem; scroll-behavior:smooth;
}
.chat-messages-empty{ flex:1; display:flex; align-items:center; justify-content:center; gap:1rem; color:var(--chat-text-muted); font-size:.875rem; }

.chat-msg{ display:flex; gap:.75rem; align-items:flex-start; }
.chat-msg.user{ flex-direction:row-reverse; }

.chat-avatar{ flex-shrink:0; }
.sd-avatar.user{ width:40px; height:40px; border-radius:9999px; display:grid; place-items:center; overflow:hidden; margin-top:4px; background:#eff6ff; border:1px solid #e5e7eb; box-shadow:0 1px 3px rgba(0,0,0,.1); }
.sd-avatar-img{ width:100%; height:100%; object-fit:cover; display:block; }

.chat-bubble{ max-width:70%; min-width:0; }
.chat-author{ font-size:12px; font-weight:600; margin:0 0 4px 0; color:#6b7280; }
.chat-msg.user .chat-author{ text-align:right; color:rgba(255,255,255,.9); }

.chat-text{
  background:var(--chat-surface); color:var(--chat-text);
  padding:.75rem 1rem; border-radius:var(--chat-radius); font-size:.875rem; line-height:1.5; word-wrap:break-word; margin-bottom:.25rem;
}
.chat-msg.user .chat-text{ background:var(--chat-primary); color:#fff; }
.chat-msg.system .chat-text{ background:var(--chat-warning); color:#fff; font-style:italic; }

.chat-attachments-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:.5rem; margin-bottom:.25rem; }
.chat-attachment{ display:block; border-radius:var(--chat-radius); overflow:hidden; border:1px solid var(--chat-border); transition:transform .2s ease, box-shadow .2s ease; }
.chat-attachment:hover{ transform:scale(1.02); box-shadow:var(--chat-shadow); }
.chat-attachment img{ width:100%; height:auto; max-height:200px; object-fit:cover; display:block; }

.chat-time{ font-size:.75rem; color:var(--chat-text-light); text-align:right; margin-top:.25rem; }
.chat-msg.user .chat-time{ text-align:left; }

/* Drag & drop overlay */
.chat-drop-overlay{
  position:absolute; inset:0; z-index:10; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:1rem;
  background:rgba(37,99,235,.1); backdrop-filter:blur(4px); color:var(--chat-primary); font-weight:600;
  border:2px dashed var(--chat-primary); border-radius:var(--chat-radius); margin:1rem;
}

/* ---------- Input ---------- */
.chat-input-row{
  padding:1rem; border-top:1px solid var(--chat-border); background:var(--chat-bg);
  display:flex; align-items:flex-end; gap:.75rem;
}
.chat-img-btn,.chat-send-btn{
  width:2.5rem; height:2.5rem; flex-shrink:0; border:0; border-radius:var(--chat-radius);
  display:flex; align-items:center; justify-content:center; cursor:pointer; transition:all .2s ease;
}
.chat-img-btn{ background:var(--chat-surface); color:var(--chat-text-muted); border:1px solid var(--chat-border); }
.chat-img-btn:hover:not(:disabled){ background:var(--chat-surface-hover); color:var(--chat-text); }
.chat-send-btn{ background:var(--chat-primary); color:#fff; }
.chat-send-btn:hover:not(:disabled){ background:var(--chat-primary-hover); }
.chat-send-btn:disabled,.chat-img-btn:disabled{ opacity:.5; cursor:not-allowed; }

.chat-input{
  flex:1; min-height:2.5rem; max-height:6rem; padding:.75rem;
  border:1px solid var(--chat-border); border-radius:var(--chat-radius);
  background:var(--chat-bg); color:var(--chat-text); font-size:.875rem; line-height:1.4;
  resize:none; font-family:inherit; transition:all .2s ease;
}
.chat-input:focus{ outline:none; border-color:var(--chat-primary); box-shadow:0 0 0 3px rgba(37,99,235,.1); }
.chat-input::placeholder{ color:var(--chat-text-muted); }

/* ---------- Scrollbars ---------- */
.chat-thread-list::-webkit-scrollbar,
.chat-messages::-webkit-scrollbar{ width:6px; }
.chat-thread-list::-webkit-scrollbar-thumb,
.chat-messages::-webkit-scrollbar-thumb{ background:var(--chat-border); border-radius:3px; }
.chat-thread-list::-webkit-scrollbar-thumb:hover,
.chat-messages::-webkit-scrollbar-thumb:hover{ background:var(--chat-text-muted); }

/* ---------- Accessibility ---------- */
.chat-container,.chat-launcher,.chat-thread-item,.chat-msg,.chat-input,.chat-img-btn,.chat-send-btn{ transition:all .2s cubic-bezier(.4,0,.2,1); }
.chat-launcher:focus,.chat-reload:focus,.chat-new-btn-support:focus,.chat-thread-item:focus,.chat-img-btn:focus,.chat-send-btn:focus{
  outline:2px solid var(--chat-primary); outline-offset:2px;
}

/* NEW — “New chat” subject form */
.chat-new-form{
  margin:12px;
  padding:12px;
  background:var(--chat-bg);
  border:1px solid var(--chat-border);
  border-radius:var(--chat-radius);
  box-shadow:var(--chat-shadow-sm);
  animation:chatSlideDown .18s ease;
}

.chat-new-form-label{
  display:block;
  font-size:.8rem;
  font-weight:700;
  color:var(--chat-text-muted);
  margin-bottom:.35rem;
  letter-spacing:.01em;
}

.chat-new-form-input{
  width:100%;
  height:42px;
  padding:0 .9rem;
  border:1px solid var(--chat-border);
  border-radius:12px;
  background:var(--chat-surface);
  color:var(--chat-text);
  font-size:.9rem; /* fixed */
  outline:none;
  transition:border-color .2s, box-shadow .2s, background .2s;
}
.chat-new-form-input::placeholder{ color:var(--chat-text-light); }
.chat-new-form-input:focus{
  /* fallbacks for color-mix() */
  border-color:var(--chat-primary);
  box-shadow:0 0 0 3px rgba(37,99,235,.15);
  /* enhanced (browsers that support color-mix) */
  border-color:color-mix(in srgb, var(--chat-primary) 65%, var(--chat-border));
  box-shadow:0 0 0 3px color-mix(in srgb, var(--chat-primary) 20%, transparent);
  background:var(--chat-bg);
}

.chat-new-form-actions{
  display:flex;
  align-items:center;
  gap:.5rem;
  margin-top:.75rem;
}

.chat-new-form-primary,
.chat-new-form-cancel{
  appearance:none;
  border:0;
  border-radius:12px;
  padding:.65rem 1rem;
  font-weight:700;
  font-size:.85rem;
  cursor:pointer;
  transition:transform .06s ease, background .2s ease, opacity .2s ease, border-color .2s ease;
}

.chat-new-form-primary{
  background:var(--chat-primary);
  color:#fff;
}
.chat-new-form-primary:hover{ background:var(--chat-primary-hover); }
.chat-new-form-primary:active{ transform:translateY(1px); }
.chat-new-form-primary:disabled{ opacity:.55; cursor:not-allowed; }

.chat-new-form-cancel{
  background:var(--chat-surface);
  color:var(--chat-text);
  border:1px solid var(--chat-border);
}
.chat-new-form-cancel:hover{ background:var(--chat-surface-hover); }

.chat-new-form-hint{
  margin-top:.6rem;
  font-size:.8rem;
  color:var(--chat-text-muted);
}
.chat-new-form-hint em{
  color:var(--chat-text);
  font-style:italic;
  background:var(--chat-surface);
  padding:.2rem .45rem;
  border-radius:.5rem;
  border:1px dashed var(--chat-border);
}

/* subtle slide-in */
@keyframes chatSlideDown{
  from{ opacity:0; transform:translateY(-4px); }
  to{ opacity:1; transform:translateY(0); }
}

/* mobile polish */
@media (max-width:640px){
  .chat-new-form{
    margin:12px;
    padding:12px;
    border-radius:14px;
  }
}


@media (prefers-reduced-motion: reduce){
  *{ animation-duration:.01ms !important; animation-iteration-count:1 !important; transition-duration:.01ms !important; }
  .chat-messages{ scroll-behavior:auto; }
}

.mobile-only { display: none !important; }

@media (max-width: 640px) {
  .mobile-only { display: inline-flex !important; } /* or block if you prefer */
}


/* ===========================
   RESPONSIVE (only what we need)
   =========================== */

@media (min-width: 641px){
  .hamburger-btn{ display:none; }
  .chat-drawer-scrim{ display:none !important; }
}

/* Mobile ≤ 640px: full-screen + drawer + hamburger→X */
@media (max-width: 640px){
  /* Full-screen container */
  .chat-container{
    inset:0; right:0; bottom:0; left:0;
    width:100vw; height:100dvh; max-width:none; max-height:none;
    border:0; border-radius:0; box-shadow:none; overflow:hidden;
    z-index:2147483647; background:var(--chat-bg);
  }

  /* Header + content padding tweaks */
  .chat-window-header{
    position:sticky; top:0; z-index:4;
    gap:.5rem; min-height:48px; padding:.75rem; background:var(--chat-bg); border-bottom:1px solid var(--chat-border);
  }
  .chat-window-title{ flex:1; display:flex; align-items:center; gap:.25rem; min-width:0; }
  .chat-messages{ padding:.75rem; }
  .chat-input-row{ padding:.75rem; gap:.5rem; }

  /* Hamburger button */
  .hamburger-btn{
    display:inline-flex;
    flex-direction:column; align-items:center; justify-content:center;
    gap:var(--hb-gap);
    width:var(--hb-size); height:var(--hb-size);
    min-width:44px; min-height:44px;
    margin-right:8px; padding:0;
    color:var(--chat-text); background:var(--chat-bg);
    border:1px solid var(--chat-border); border-radius:12px;
    box-shadow:var(--chat-shadow-sm);
    cursor:pointer; -webkit-tap-highlight-color:transparent;
    transition:background .2s, border-color .2s, box-shadow .2s, transform .08s;
  }
  .hamburger-btn:hover{ background:var(--chat-surface-hover); }
  .hamburger-btn:active{ transform:scale(.98); }
  .hamburger-btn:focus-visible{
    outline:none;
    border-color:color-mix(in srgb, var(--chat-primary) 55%, var(--chat-border));
    box-shadow:0 0 0 3px color-mix(in srgb, var(--chat-primary) 25%, transparent);
  }
  .hamburger-bar{
    width:var(--hb-bar-w); height:var(--hb-bar-h);
    background:currentColor; border-radius:999px; transform-origin:center;
    transition:transform .22s ease, opacity .18s ease;
  }

  /* Morph to X when drawer open */
  .chat-container.drawer-open .hamburger-bar:nth-child(1){ transform:translateY(var(--hb-x-shift)) rotate(45deg); }
  .chat-container.drawer-open .hamburger-bar:nth-child(2){ opacity:0; transform:scaleX(.65); }
  .chat-container.drawer-open .hamburger-bar:nth-child(3){ transform:translateY(calc(-1 * var(--hb-x-shift))) rotate(-45deg); }

  /* Drawer sidebar */
  .chat-sidebar{
    position:absolute; top:0; bottom:0; left:0;
    width:min(86vw,360px); max-width:90vw; height:100%;
    transform:translateX(-100%); transition:transform .25s ease;
    z-index:5; display:flex; flex-direction:column; background:var(--chat-surface); border-right:1px solid var(--chat-border);
  }
  .chat-thread-list{ flex:1; overflow-y:auto; }

  .chat-container.drawer-open .chat-sidebar{ transform:translateX(0); box-shadow:var(--chat-shadow-xl); }

  /* Scrim */
  .chat-drawer-scrim{
    position:absolute; inset:0; background:rgba(0,0,0,.35);
    opacity:0; pointer-events:none; transition:opacity .2s ease; z-index:3; display:block;
  }
  .chat-container.drawer-open .chat-drawer-scrim{ opacity:1; pointer-events:auto; }

  /* Safe areas (iPhone X+) */
  @supports(padding:max(0px)){
    .chat-window-header{ padding-left:max(.75rem, env(safe-area-inset-left)); padding-right:max(.75rem, env(safe-area-inset-right)); }
    .chat-input-row{ padding-left:max(.75rem, env(safe-area-inset-left)); padding-right:max(.75rem, env(safe-area-inset-right)); padding-bottom:max(.75rem, env(safe-area-inset-bottom)); }
  }

  .chat-new-btn-support{
    position: relative;
    left: 95px;
  }

  .chat-delete-btn{
    position: relative;
    right: 10px;
  }

}

/* Short landscape phones */
@media (max-height:420px) and (orientation:landscape) and (max-width:812px){
  .chat-window-header{ padding:.5rem; }
  .chat-messages{ padding:.5rem; }
  .chat-input-row{ padding:.5rem; }
}

/* Optional high-contrast tweak */
@media (prefers-contrast: high){
  :root{ --chat-border:#000; --chat-text-muted:#333; }
}

/* ===== Scroll lock when chat is open on mobile ===== */
@media (max-width: 640px) {
  body.chat-scroll-lock {
    position: fixed;
    overflow: hidden;
    width: 100%;
  }
  /* Optional: also clamp the chat's own scroll chaining */
  .chat-container {
    overscroll-behavior: contain;
  }
}
